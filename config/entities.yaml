version: 1
extractor: regex:v1

# Справочник типов сущностей (для самодокументации и будущей валидации)
entity_types:
  # из текста (regex)
  - azs
  - workplace
  - sd_ticket
  - terminal
  - sd_dt

  # из справочника terminal_directory (enrichment)
  - tid              # terminal_id банка (строго 8 цифр)
  - ip               # ip рабочего места (IPv4 строкой)
  - serial_number    # серийный номер терминала (пока не заполняем)

patterns:
  # ------------------------------------------------------------
  # SD / Ticket (номер заявки)
  # ------------------------------------------------------------
  sd_ticket:
    # "Заявка 1888290", "тикет 1888290", "инцидент 1888290", "обращение 1888290"
    - name: "sd_ticket_keywords_6plus"
      regex: "(?i)\\b(?:заявк(?:а|е|и|у|ой)|тикет|инцидент|обращен(?:ие|ия)|service\\s*desk|servicedesk|sd)\\b[^0-9]{0,25}(?:в\\s*(?:ис|sd|сд)\\b[^0-9]{0,10})?(?:№|n|no|номер)?\\s*[:#№\\-]?\\s*(\\d{6,})\\b"
      confidence: 0.95

    # "ИС 1888290", "SD: 1888290", "СД 1888290"
    - name: "sd_ticket_is_sd_prefix"
      regex: "(?i)\\b(?:ис|sd|сд)\\s*[:#№\\-]?\\s*(\\d{6,})\\b"
      confidence: 0.9

    # "по заявке 1888290", "заявка №1888290"
    - name: "sd_ticket_by_claim"
      regex: "(?i)\\bпо\\s+заявк(?:е|е\\s*№|е\\s*:)\\s*(?:№|n|no)?\\s*[:#№\\-]?\\s*(\\d{6,})\\b"
      confidence: 0.85

    # "#1888290", "№1888290" (только 6+ цифр, чтобы не ловить мелочь)
    - name: "sd_ticket_hash_or_num_sign"
      regex: "(?i)\\b(?:#|№)\\s*(\\d{6,})\\b"
      confidence: 0.8

  # ------------------------------------------------------------
  # AZS (номер АЗС / точки)
  # ------------------------------------------------------------
  azs:
    - name: "azs_digits_1to5"
      regex: "(?i)\\b(?:азс|aзс)\\s*[:#№\\-]?\\s*(\\d{1,5})\\b"
      confidence: 0.9

    - name: "azs_compact"
      regex: "(?i)\\b(?:азс|aзс)[\\-\\s]?(\\d{1,5})\\b"
      confidence: 0.85

  # ------------------------------------------------------------
  # Workplace / Cashdesk / RM (рабочее место)
  # ------------------------------------------------------------
  workplace:
     # "на рабочих местах #1,2,3,4,5" / "рабочие места 1,2,3"
    - name: "rm_list_after_hash_or_text"
      regex: "(?i)\\bрабоч\\w*\\s+мест\\w*\\b[^0-9]{0,20}#?\\s*((?:\\d{1,2}\\s*,\\s*)+\\d{1,2})\\b"
      confidence: 0.9

    # "РМ 1", "РМ№1", "workplace 1", "раб. место 1"
    - name: "rm_after_token"
      regex: "(?i)\\b(?:рм|раб\\.?\\s*место|рабоч(?:ее|ем)\\s*место|workplace)\\s*[:#№\\-]?\\s*(\\d{1,2})\\b"
      confidence: 0.85

    # "1 РМ", "1-ое РМ", "2-м рабочем месте"
    - name: "rm_before_token"
      regex: "(?i)\\b(\\d{1,2})\\s*(?:-?\\s*(?:е|е\\s*|ое|й|м))?\\s*(?:рм|раб\\.?\\s*место|рабоч(?:ее|ем)\\s*место|workplace)\\b"
      confidence: 0.8

    # "РМ1", "РМ-1", "1РМ"
    - name: "rm_compact"
      regex: "(?i)\\b(?:рм)[\\-\\s]?(\\d{1,2})\\b"
      confidence: 0.75

    - name: "rm_compact_reverse"
      regex: "(?i)\\b(\\d{1,2})\\s*(?:рм)\\b"
      confidence: 0.7

    # Новые форматы: "касса 3", "на кассе №3", "касса#3"
    - name: "cashdesk_1to2_digits"
      regex: "(?i)\\bкасс[аеи]\\s*[:#№\\-]?\\s*(\\d{1,2})\\b"
      confidence: 0.75

    # "К-3", "К3", "К №3" — оставляем, но делаем более безопасным (нужна граница после цифр)
    - name: "kassa_short_k_1to2_digits"
      regex: "(?i)\\bк\\s*[:#№\\-]?\\s*(\\d{1,2})\\b(?!\\s*ч)"
      confidence: 0.6

    # "пост 2", "пост№2"
    - name: "post_1to2_digits"
      regex: "(?i)\\bпост\\s*[:#№\\-]?\\s*(\\d{1,2})\\b"
      confidence: 0.6

    # Формат: "на первом РМ", "на 2-м рабочем месте" (слова + РМ)
    - name: "ordinal_before_rm"
      regex: "(?i)\\b(перв(?:ом|ый|ого)|втор(?:ом|ой|ого)|трет(?:ем|ий|ьего)|четверт(?:ом|ый|ого)|пят(?:ом|ый|ого)|шест(?:ом|ой|ого)|седьм(?:ом|ой|ого)|восьм(?:ом|ой|ого)|девят(?:ом|ый|ого)|десят(?:ом|ый|ого))\\s*(?:рм|раб\\.?\\s*место|workplace)\\b"
      confidence: 0.7

  # ------------------------------------------------------------
  # TID (terminal_id в процессинге)
  # Формат: ровно 8 цифр, начинается с 6 или 7
  # Примеры: 61234567, 71234567
  # ------------------------------------------------------------
  tid:
    # "терминал 61234567", "TID 71234567", "pos 61234567"
    - name: "tid_with_keyword"
      regex: "(?i)\\b(?:tid|терминал|pos)\\s*[:#№\\-]?\\s*((?:6|7)\\d{7})\\b"
      confidence: 0.9

    # Просто число в тексте (аккуратно, но допустимо)
    - name: "tid_bare_8_digits"
      regex: "\\b((?:6|7)\\d{7})\\b"
      confidence: 0.75

  # ------------------------------------------------------------
  # SD date-time (для привязки к заявке/инциденту)
  # ------------------------------------------------------------
  sd_dt:
    - name: "sd_dt_ru"
      regex: "\\b(\\d{1,2}[\\./]\\d{1,2}[\\./]\\d{2,4})\\s*(\\d{1,2}:\\d{2}(?::\\d{2})?)\\b"
      confidence: 0.5
