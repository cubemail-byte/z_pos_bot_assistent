# tg-agent — ПРИНЯТЫЕ РЕШЕНИЯ

Этот файл фиксирует архитектурные и продуктовые решения,
чтобы не возвращаться к одним и тем же обсуждениям.

---

## D001 — Сначала сбор данных, потом анализ
**Решение:**  
Все сообщения сохраняются в БД в «сыром» виде.
Парсинг, классификация и аналитика будут добавлены позже.

**Почему:**  
- нельзя восстановить утерянные данные
- логика анализа будет меняться
- raw-данные нужны для перепроигрывания алгоритмов

---

## D002 — Разделение ingestion и анализа
**Решение:**  
Слой сбора сообщений и слой анализа — разные части системы.

**Почему:**  
- упрощает архитектуру
- снижает риск поломок
- позволяет отключать анализ без потери данных

---

## D003 — Секреты не хранятся в репозитории
**Решение:**  
Все секреты (`BOT_TOKEN` и т.п.) находятся только в `.env` на VPS.

В репозитории может быть только `.env.example`.

**Почему:**  
- безопасность
- стандартная практика
- проще менять токены без коммитов

---

## D004 — Бот не отвечает в группах
**Решение:**  
Бот работает в «бесшумном» режиме и не пишет в групповые чаты.

**Почему:**  
- не мешает живому общению
- не привлекает внимания клиентов
- снижает риски случайных сообщений

---

## D005 — SQLite на старте
**Решение:**  
Используется SQLite как хранилище на первом этапе.

**Почему:**  
- простота
- минимальные накладные расходы
- достаточно для начального объёма

Миграция на PostgreSQL возможна позже.

## D006 — Надёжный raw ingestion
**Решение:**  
- расширение `messages` метаданными (reply/forward/service/raw_json)
- роли участников (ENGINEER/BANK/CLIENT/UNKNOWN) из YAML
- базовые проверки и health-команды

## D007 — Эскалационные кейсы
- `escalation_cases` + привязка сообщений к кейсам
- TTFR, “без реакции”, “reopen/повтор”
- сохранение атрибутов кейса (ticket/AZS/workplace/terminal/model/version)

## D008 — Типы проблем / симптоматика
- таксономия problem_code
- YAML-правила include/exclude + веса
- прозрачность: какие правила сработали, confidence

## D009 — Аналитика и отчёты
- всплески по АЗС/модели/версии ПО
- тренды по неделям/релизам
- топ проблем, топ повторов, проблемные кластеры

## D010 — Ассистирование оператору (опционально)
- генерация подсказок/уточняющих вопросов для человека (без постинга ботом в клиентский чат)
- аккуратные сценарии для массовых инцидентов