# tg-agent — ПРИНЯТЫЕ РЕШЕНИЯ

Этот файл фиксирует архитектурные и продуктовые решения проекта.

---

## D001 — Raw ingestion прежде всего
**Решение:**  
Все сообщения сохраняются в БД в максимально полном «сыром» виде.

**Почему:**  
- данные нельзя восстановить
- правила и логика будут меняться
- возможен повторный прогон классификации

---

## D002 — Эскалационный чат ≠ Service Desk
**Решение:**  
Чат рассматривается как слой эскалаций и реакции,
а не как источник заявок.

**Почему:**  
- заявки живут в SD
- здесь фиксируется отклонение от нормы

---

## D003 — Разделение ingestion и анализа
**Решение:**  
Сбор сообщений и анализ — разные слои.

---

## D004 — Бот работает в бесшумном режиме
**Решение:**  
Бот не пишет в группах.

---

## D005 — SQLite на старте
**Решение:**  
SQLite используется как основное хранилище на первом этапе.

---

## D006 — Расширенный raw-слой
**Решение:**  
Таблица `messages` хранит:
- reply / forward / service events
- content_type / has_media
- raw_json

---

## D007 — Слой классификации сообщений
**Решение:**  
Введена таблица `message_classification`.

Начальное состояние:
- problem_domain = UNCLASSIFIED
- problem_symptom = UNKNOWN
- is_unclassified = 1

---

## D008 — Правила вместо «магии»
**Решение:**  
Классификация строится на YAML-правилах:
- include / exclude
- прозрачность
- confidence
- версия ruleset

---

## D009 — UNCLASSIFIED как актив
**Решение:**  
Неклассифицированные сообщения:
- анализируются вручную
- используются для расширения правил
- повторно классифицируются джобом

---

## D010 — Аналитика как конечная цель
**Решение:**  
Фокус аналитики:
- реакции на эскалации
- повторяемость проблем
- всплески по АЗС / моделям / версиям ПО
